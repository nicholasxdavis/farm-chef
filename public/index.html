<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FARMesilla | Catering Services | Mesilla, NM</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#f5e7d0',
            primary2: '#e8d9c0',
            secondary: '#432f25',
            accent: '#5c4032'
          },
          fontFamily: {
            title: ['"Bernard MT Condensed"', 'serif'],
            body: ['"Adabi MT Light"', 'sans-serif']
          }
        }
      }
    }
</script>

<style>
body {
  background-color: #f5e7d0;
  background-image: url('https://www.transparenttextures.com/patterns/soft-wallpaper.png');
  background-repeat: repeat;
  background-size: auto;
  position: relative;
}

body::before {
  content: "";
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background-image: url('https://www.transparenttextures.com/patterns/soft-wallpaper.png');
  opacity: 0.1;
  pointer-events: none;
  z-index: 0;
}

body {
  font-family: 'Adabi MT Light', sans-serif;
  letter-spacing: 0.02em;
}

h1, h2, h3, h4, p1 {
  font-family: 'Bernard MT Condensed', serif;
  font-weight: 500;
  letter-spacing: 0.05em;
  text-transform: uppercase;
}

.section-content {
  position: relative;
  z-index: 2;
}

.menu-item-image {
  width: 96px;
  height: 96px;
  object-fit: cover;
  border-radius: 8px;
  border: 2px solid #c8b697;
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-content {
  background: white;
  border-radius: 8px;
  padding: 2rem;
  max-width: 90vw;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
}

.close-btn {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
}

.hidden { display: none; }

.editable-item {
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 1rem;
  background: #f9fafb;
}

.edit-form input, .edit-form textarea, .edit-form select {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid #d1d5db;
  border-radius: 4px;
  margin-bottom: 0.5rem;
}

.save-btn, .edit-btn, .delete-btn, .cancel-btn {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  margin-right: 0.5rem;
  margin-bottom: 0.5rem;
}

.save-btn { background: #10b981; color: white; }
.edit-btn { background: #3b82f6; color: white; }
.delete-btn { background: #ef4444; color: white; }
.cancel-btn { background: #6b7280; color: white; }

.collapsible-content {
  transition: max-height 0.3s ease-out;
  overflow: hidden;
}

.toggle-arrow {
  display: inline-block;
  transition: transform 0.3s ease;
}
</style>
</head>

<nav class="bg-secondary top-0 z-50 shadow-md">
    <div class="container mx-auto px-4 sm:px-6 py-3 md:py-4">
        <div class="flex items-center justify-between">
            <!-- Logo/Brand -->
            <div class="flex items-center">
                <a href="#" class="flex items-center">
                    <img src="assets/logo.png" alt="FARMesilla" class="h-28 md:h-28">
                </a>
            </div>

            <!-- Desktop Navigation -->
            <div class="hidden md:flex items-center space-x-8">
                <a href="#" class="text-primary text-sm md:text-base tracking-wider hover:text-accent transition duration-300 font-title">HOME</a>
                <a href="#catering-menu" class="text-primary text-sm md:text-base tracking-wider hover:text-accent transition duration-300 font-title">CATERING</a>
                <a href="#" class="text-primary text-sm md:text-base tracking-wider hover:text-accent transition duration-300 font-title">MENU</a>
                <a href="#" class="text-primary text-sm md:text-base tracking-wider hover:text-accent transition duration-300 font-title">ABOUT</a>
                <a href="#" class="text-primary text-sm md:text-base tracking-wider hover:text-accent transition duration-300 font-title">CONTACT</a>
                <a href="#catering-form" class="bg-primary text-secondary px-4 py-2 rounded-full hover:bg-accent transition duration-300 text-sm tracking-wider font-title">ORDER NOW</a>
                
                <!-- Account Icon -->
                <button id="account-btn" class="text-primary hover:text-accent transition duration-300 p-2">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </button>
            </div>

            <!-- Mobile menu button -->
            <div class="md:hidden flex items-center space-x-4">
                <!-- Mobile Account Icon -->
                <button id="mobile-account-btn" class="text-primary hover:text-accent transition duration-300 p-2">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </button>
                
                <button type="button" class="mobile-menu-button text-primary focus:outline-none">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>

<div class="mobile-menu hidden md:hidden pt-4 pb-2">
    <div class="flex flex-col items-center justify-center space-y-3 text-center">
        <a href="#" class="block px-3 py-2 hover:text-accent text-primary text-sm tracking-wider font-title">HOME</a>
        <a href="#catering-menu" class="block hover:text-accent px-3 py-2 text-primary text-sm tracking-wider font-title">CATERING</a>
        <a href="#" class="block px-3 py-2 hover:text-accent text-primary text-sm tracking-wider font-title">MENU</a>
        <a href="#" class="block px-3 py-2 hover:text-accent text-primary text-sm tracking-wider font-title">ABOUT</a>
        <a href="#" class="block px-3 py-2 hover:text-accent text-primary text-sm tracking-wider font-title">CONTACT</a>
        <a href="#catering-form" class="block hover:text-accent bg-primary text-secondary text-center px-4 py-2 rounded-full text-sm tracking-wider mt-2 font-title">ORDER NOW</a>
    </div>
</div>

</div>
</nav>

<!-- Account/Dashboard Modal -->
<div id="account-modal" class="fixed inset-0 bg-black/50 z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h2 id="modal-main-title" class="text-2xl font-bold text-gray-900">Menu Management Dashboard</h2>
                <button id="close-modal" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            
            <!-- Auth Section -->
            <div id="auth-section" class="p-6">
                <div class="max-w-md mx-auto">
                    <!-- Login Form Only -->
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold mb-4 text-gray-900">Chef Login</h3>
                        <form id="login-form">
                            <input type="email" id="login-email" placeholder="Email" class="w-full p-3 border border-gray-300 rounded-md mb-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <input type="password" id="login-password" placeholder="Password" class="w-full p-3 border border-gray-300 rounded-md mb-4 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <button type="submit" class="w-full bg-gray-900 text-white p-3 rounded-md hover:bg-gray-800 transition-colors">Login</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="hidden">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex space-x-4">
                            <button id="add-item-btn" class="bg-black text-white px-6 py-3 rounded-lg hover:bg-gray-800 transition-colors flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                Add New Item
                            </button>
                        </div>
                        <button id="logout-btn" class="bg-black text-white px-6 py-3 rounded-lg hover:bg-gray-800 transition-colors">Logout</button>
                    </div>
                    
                    <!-- Menu Items Grid -->
                    <div id="menu-items-dashboard" class="grid gap-6">
                        <div id="items-list"></div>
                    </div>
                </div>
            </div>

            <!-- Item Form Section (Hidden by default) -->
            <div id="item-form-section" class="hidden">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 id="item-form-title" class="text-xl font-bold text-gray-900">Add New Item</h3>
                        <button id="back-to-dashboard" class="text-gray-400 hover:text-gray-600 flex items-center">
                            <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                            Back to Dashboard
                        </button>
                    </div>
                    
                    <form id="item-form">
                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- Basic Info -->
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Item Name *</label>
                                    <input type="text" id="item-name" class="w-full p-3 border border-gray-300 rounded-md mb-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Price (for 5 people) *</label>
                                    <input type="number" id="item-price" step="0.01" class="w-full p-3 border border-gray-300 rounded-md mb-4 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Category *</label>
                                    <div class="space-y-2">
                                        <select id="item-category" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="handleCategoryChange(this)">
                                            <option value="">Select Category</option>
                                            <option value="tortas">Tortas & Wraps</option>
                                            <option value="salads">Salads</option>
                                            <option value="bowls">Bowls</option>
                                            <option value="enchiladas">Enchiladas</option>
                                            <option value="sides">Sides</option>
                                            <option value="desserts">Desserts</option>
                                            <option value="beverages">Beverages</option>
                                            <option value="custom">+ Create New Category</option>
                                        </select>
                                        <input type="text" id="custom-category" placeholder="Enter new category name" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent hidden">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Image URL</label>
                                    <input type="url" id="item-image-url" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                
                                <div class="flex items-center">
                                    <input type="checkbox" id="item-available" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <label for="item-available" class="ml-2 block text-sm text-gray-700">Available</label>
                                </div>
                            </div>
                            
                            <!-- Description and Tags -->
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                    <textarea id="item-description" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                </div>
                                
                                <!-- Dietary Tags -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Dietary Tags</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="tag-gf" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                            <span class="ml-2 text-sm text-gray-700">Gluten Free (GF)</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="tag-v" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                            <span class="ml-2 text-sm text-gray-700">Vegan (V)</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="tag-n" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                            <span class="ml-2 text-sm text-gray-700">Contains Nuts (N)</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Add-ons Section -->
                        <div class="mt-6 border-t pt-6">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="text-lg font-medium text-gray-900">Add-ons</h4>
                                <button type="button" id="add-addon-btn" class="bg-black text-white px-4 py-2 rounded-md hover:bg-gray-800 transition-colors text-sm">
                                    Add Add-on
                                </button>
                            </div>
                            <div id="addons-container" class="space-y-3">
                                <!-- Add-ons will be dynamically added here -->
                            </div>
                        </div>
                        
                        <div class="flex justify-end space-x-4 mt-8 pt-6 border-t">
                            <button type="button" id="cancel-item" class="px-6 py-3 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors">Cancel</button>
                            <button type="submit" id="save-item" class="px-6 py-3 bg-black text-white rounded-md hover:bg-gray-800 transition-colors">Save Item</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<body class="text-secondary"
  style="background-color: #f5dfbf ;
         background-image: url('https://www.transparenttextures.com/patterns/soft-wallpaper.png');
         background-repeat: repeat;
         background-size: auto;
         background-blend-mode: multiply;">

<!-- Catering Menu Section -->
<section id="catering-menu" class="py-12 md:py-20 section-curve">
    <form action="https://formspree.io/f/meogonnn" method="POST" id="catering-form">
    <div class="container mx-auto px-4 sm:px-6 section-content">
<!-- Menu Intro -->
<div class="max-w-4xl mx-auto mb-12 md:mb-16 text-center">
    <h1 class="text-3xl md:text-4xl font-display mb-4 md:mb-6 tracking-wider">GATHER YOUR CREW</h1>
<p class="mb-4 md:mb-6 text-sm md:text-base text-[your-text-color-class]">
    Our <strong>FARM-2-GO</strong> order form is perfect for GROUP ORDERS, offering shared platters of good choices
    <span class="hidden sm:inline"><br></span>
    like farm-fresh salads, protein bowls and healthy snacks & desserts, all made from scratch.
    <img src="assets/leaf.svg" alt="Leaf icon" class="inline-block h-4 w-4 align-text-bottom fill-current text-inherit">
</p>
    <p class="text-xs md:text-sm tracking-wider"><strong>#eatgoodfeelgood &nbsp; #eatgoodworkhappy &nbsp; #FARMesilla</strong></p>
</div>

<div class="text-center mb-8 md:mb-12">
    <h2 class="text-2xl md:text-3xl mb-3 md:mb-4 tracking-widest">CATERING MENU</h2>
    <div class="w-20 h-1 bg-accent mx-auto mb-4 md:mb-6"></div>
    <div class="flex flex-wrap justify-center gap-2 md:gap-4 mb-4 md:mb-6 text-xs md:text-sm">
        <span class="bg-secondary text-primary px-2 md:px-3 py-1 rounded-full">GF = GLUTEN FREE</span>
        <span class="bg-secondary text-primary px-2 md:px-3 py-1 rounded-full">V = VEGAN</span>
        <span class="bg-secondary text-primary px-2 md:px-3 py-1 rounded-full">N = CONTAINS NUTS</span>
    </div>
</div>

<!-- Portion Size Selector -->
<div class="max-w-xs mx-auto mb-10 text-center">
    <p class="mb-3 font-medium">SELECT PORTION SIZE</p>
    <div class="relative flex items-center justify-center">
        <button type="button" class="portion-btn" onclick="adjustPortion(-1)">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M5 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
        </button>
        
        <div class="mx-4 px-6 py-2 border-b-2 border-accent text-center min-w-[120px]">
            <span id="portion-size" class="text-2xl font-display">10</span>
            <span class="ml-1 text-sm">people</span>
        </div>
        
        <button type="button" class="portion-btn" onclick="adjustPortion(1)">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
        </button>
    </div>
    <p class="mt-2 text-xs text-secondary-500">Standard portion sizes: 5, 10 or 20 people</p>
</div>

<style>
    .portion-btn {
        @apply rounded-full w-8 h-8 flex items-center justify-center 
               border border-primary text-primary hover:bg-accent 
               hover:text-white transition-colors duration-200
               focus:outline-none focus:ring-2 focus:ring-accent;
    }
</style>

<!-- Dynamic Menu Items Container -->
<div id="menu-categories-container"></div>

        <!-- Combined Order Form -->
        <div class="max-w-4xl mx-auto bg-primary p-4 md:p-8 rounded-lg shadow-md">
            <div class="mb-6 md:mb-8">
                <h4 class="text-lg md:text-xl mb-3 md:mb-4 font-bold tracking-wider">YOUR SELECTED ITEMS</h4>
                <div id="order-items-display" class="border border-secondary/20 rounded-lg p-3 md:p-4 mb-3 md:mb-4 min-h-24 md:min-h-32">
                    <p class="text-center text-secondary/60 text-sm md:text-base">Your selected items will appear here</p>
                </div>
                <div class="flex justify-between items-center">
                    <div>
                        <p class="font-bold tracking-wider text-sm md:text-base">SUBTOTAL:</p>
                        <p class="text-xs md:text-sm">18% PREPARATION FEE WILL BE ADDED</p>
                    </div>
                    <p id="subtotal-display" class="text-xl md:text-2xl">$0.00</p>
                </div>
                <div class="text-center mt-4 md:mt-6">
                    <p class="text-xs md:text-sm mb-3 md:mb-4 tracking-wider">DELIVERY RATES ARE CALCULATED PER DISTANCE</p>
                </div>
            </div>
            
            <h3 class="text-xl md:text-2xl mb-4 md:mb-6 text-center tracking-wider">CLIENT INFORMATION</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-4 md:mb-6">
                <div>
                    <label class="block mb-1 md:mb-2 font-bold tracking-wider text-sm md:text-base">CLIENT NAME</label>
                    <input type="text" name="client_name" class="w-full px-3 md:px-4 py-1 md:py-2 border border-secondary/60 bg-secondary bg-opacity-20 rounded-lg text-sm md:text-base" required>
                </div>
                <div>
                    <label class="block mb-1 md:mb-2 font-bold tracking-wider text-sm md:text-base">CLIENT EMAIL</label>
                    <input type="email" name="client_email" class="w-full px-3 md:px-4 py-1 md:py-2 border border-secondary/60 bg-secondary bg-opacity-20 rounded-lg text-sm md:text-base" required>
                </div>
                <div>
                    <label class="block mb-1 md:mb-2 font-bold tracking-wider text-sm md:text-base">PHONE #</label>
                    <input type="tel" name="client_phone" class="w-full px-3 md:px-4 py-1 md:py-2 border border-secondary/60 bg-secondary bg-opacity-20 rounded-lg text-sm md:text-base" required>
                </div>
                <div>
                    <label class="block mb-1 md:mb-2 font-bold tracking-wider text-sm md:text-base">
                        ORDER DATE 
                        <span class="text-xs md:text-sm font-normal opacity-60">(Date this form was completed)</span>
                    </label>
                    <input type="date" name="order_date" class="w-full px-3 md:px-4 py-1 md:py-2 border border-secondary/60 bg-secondary bg-opacity-20 rounded-lg text-sm md:text-base" required>
                </div>
                <div>
                    <label class="block mb-1 md:mb-2 font-bold tracking-wider text-sm md:text-base">PICK-UP/DELIVERY DATE</label>
                    <input type="date" name="delivery_date" class="w-full px-3 md:px-4 py-1 md:py-2 border border-secondary/60 bg-secondary bg-opacity-20 rounded-lg text-sm md:text-base" required>
                </div>
                <div>
                    <label class="block mb-1 md:mb-2 font-bold tracking-wider text-sm md:text-base">PICK-UP/DELIVERY TIME</label>
                    <input type="time" name="delivery_time" class="w-full px-3 md:px-4 py-1 md:py-2 border border-secondary/60 bg-secondary bg-opacity-20 rounded-lg text-sm md:text-base" required>
                </div>
            </div>
            <div class="mb-4 md:mb-6">
                <label class="block mb-1 md:mb-2 font-bold tracking-wider text-sm md:text-base">
                    DELIVERY ADDRESS (IF APPLICABLE) 
                    <span class="text-xs md:text-sm font-normal opacity-60">(FOR PICK-UP LEAVE BLANK)</span>
                </label>
                <textarea 
  name="delivery_address" 
  rows="2" 
  class="w-full px-3 md:px-4 py-1 md:py-2 border border-secondary/20 bg-secondary bg-opacity-20 rounded-lg text-sm md:text-base" 
  required></textarea>
            </div>
            <div class="text-center">
                <p class="text-xs md:text-sm mb-4 md:mb-6 tracking-wider">ONCE SUBMITTED, A STAFF MEMBER WILL REVIEW YOUR FORM AND WILL REACH OUT FOR CONFIRMATION.</p>
                <p class="text-xs md:text-sm mb-4 md:mb-6 tracking-wider">FOR ANY QUESTIONS, EMAIL CHEF@FARMESILLA.COM</p>
                <button type="submit" class="bg-secondary text-primary px-6 md:px-8 py-2 md:py-3 rounded-full hover:bg-accent transition duration-300 tracking-wider text-sm md:text-base">SUBMIT ORDER</button>
            </div>
        </div>

        <!-- PDF Download at Bottom -->
        <div class="max-w-4xl mx-auto mt-12 md:mt-16 text-center">
            <a href="assets/farmesilla-catering-menu.pdf" download class="inline-flex items-center bg-secondary text-primary px-4 md:px-6 py-2 md:py-3 rounded-full hover:bg-accent transition duration-300 mx-auto text-sm md:text-base">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 md:h-5 md:w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                DOWNLOAD FULL MENU (PDF)
            </a>
        </div>
    </div>
    </form>
</section>

<!-- Include Supabase -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script>
// Initialize Supabase with correct configuration
const SUPABASE_URL = 'https://genodqiyehczgiqgxekv.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdlbm9kcWl5ZWhjemdpcWd4ZWt2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkzMjE4NDUsImV4cCI6MjA2NDg5Nzg0NX0.DFtdiPpjtSvWBqb92IQ1catvkhOGAu0n1NEIPj4g91E';

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let currentUser = null;
let menuItems = [];
let editingItemId = null;
let currentAddons = [];
let availableCategories = ['tortas', 'salads', 'bowls', 'enchiladas', 'sides', 'desserts', 'beverages'];

// Initialize everything
document.addEventListener('DOMContentLoaded', function() {
    console.log('Initializing application...');
    initializeAuth();
    loadMenuItems();
    loadAvailableCategories();
    setupEventListeners();
    setupPortionSelector();
    setupMobileMenu();
    
    // Show welcome popup
    showWelcomePopup();
});

// Auth functions
function initializeAuth() {
    // Check current session
    supabase.auth.getSession().then(({ data: { session } }) => {
        if (session) {
            currentUser = session.user;
            updateAuthUI();
        }
    });

    // Listen for auth changes
    supabase.auth.onAuthStateChange((event, session) => {
        if (event === 'SIGNED_IN') {
            currentUser = session.user;
            updateAuthUI();
        } else if (event === 'SIGNED_OUT') {
            currentUser = null;
            updateAuthUI();
        }
    });
}

function updateAuthUI() {
    const authSection = document.getElementById('auth-section');
    const dashboardSection = document.getElementById('dashboard-section');
    
    if (currentUser) {
        authSection.classList.add('hidden');
        dashboardSection.classList.remove('hidden');
        loadMenuItemsForDashboard();
    } else {
        authSection.classList.remove('hidden');
        dashboardSection.classList.add('hidden');
    }
}

// Menu loading functions
async function loadMenuItems() {
    try {
        console.log('Loading menu items...');
        const { data, error } = await supabase
            .from('menu_items')
            .select('*')
            .eq('is_available', true)
            .order('created_at', { ascending: false });

        if (error) {
            console.error('Error loading menu items:', error);
            return;
        }

        console.log('Loaded menu items:', data);
        menuItems = data || [];
        displayMenuItems();
    } catch (err) {
        console.error('Failed to load menu items:', err);
    }
}

function displayMenuItems() {
    const container = document.getElementById('menu-categories-container');
    if (!container) return;

    // Group items by category
    const categories = {};
    menuItems.forEach(item => {
        const category = item.category || 'other';
        if (!categories[category]) {
            categories[category] = [];
        }
        categories[category].push(item);
    });

    // Clear container
    container.innerHTML = '';

    // Create category sections
    Object.keys(categories).forEach(categoryKey => {
        const items = categories[categoryKey];
        const categoryName = getCategoryDisplayName(categoryKey);
        
        const categoryHTML = `
            <div class="max-w-4xl mx-auto mb-12 md:mb-16" data-category="${categoryKey}">
                <div class="flex items-center mb-3 m-b-4 cursor-pointer category-header">
                    <div class="flex-grow border-t border-secondary/20"></div>
                    <h3 class="text-xl md:text-2xl mx-2 md:mx-4 tracking-wider whitespace-nowrap">
                        ${categoryName}
                        <span class="toggle-arrow inline-block transition-transform duration-300" style="transform: rotate(-90deg);"> ↣</span>
                    </h3>
                    <div class="flex-grow border-t border-secondary/20"></div>
                </div>
                <div class="collapsible-content transition-all duration-300 overflow-hidden" style="max-height: 0;">
                    <p class="text-center mb-4 md:mb-6 text-xs md:text-sm">(PLATTER SERVES 5)</p>
                    <div class="space-y-6">
                        ${items.map(item => createMenuItemHTML(item)).join('')}
                    </div>
                </div>
            </div>
        `;
        
        container.insertAdjacentHTML('beforeend', categoryHTML);
    });

    // Setup collapsible functionality
    setupCollapsibleSections();
    setupOrderCalculation();
}

function getCategoryDisplayName(category) {
    const categoryNames = {
        'tortas': 'FARMHOUSE TORTAS & WRAPS',
        'salads': 'FRESH SALADS',
        'bowls': 'PROTEIN BOWLS',
        'enchiladas': 'ENCHILADAS',
        'sides': 'SIDES & SNACKS',
        'desserts': 'DESSERTS',
        'beverages': 'BEVERAGES',
        'other': 'OTHER ITEMS'
    };
    return categoryNames[category] || category.toUpperCase();
}

function createMenuItemHTML(item) {
    const addons = item.addons || [];
    const dietaryTags = item.dietary_tags || [];
    const multiplier = getPortionMultiplier();
    const adjustedPrice = (item.price * multiplier).toFixed(2);
    
    let addonHTML = '';
    if (addons.length > 0) {
        addonHTML = `
            <div class="mt-2">
                <select name="${item.id}_addons" class="text-xs p-1 border border-secondary/20 rounded bg-primary2 addon-select" data-item-id="${item.id}">
                    <option value="">Add extras (+$0)</option>
                    ${addons.map(addon => {
                        const addonPrice = (addon.price * multiplier).toFixed(2);
                        return `<option value="${addon.name}" data-price="${addonPrice}">${addon.name} (+$${addonPrice})</option>`;
                    }).join('')}
                </select>
            </div>
        `;
    }
    
    let tagsHTML = '';
    if (dietaryTags.length > 0) {
        tagsHTML = `
            <div class="flex gap-2">
                ${dietaryTags.map(tag => `<span class="dietary-tag bg-secondary/10 px-2 py-0.5 rounded text-xs">${tag}</span>`).join('')}
            </div>
        `;
    }

    return `
        <div class="flex items-start gap-4">
            <div class="flex-grow">
                <div class="flex items-start justify-between">
                    <div class="flex items-start">
                        <input type="number" min="0" name="${item.id}_qty" class="w-12 md:w-16 mr-3 px-2 py-1 border border-secondary/20 bg-primary2 rounded text-center menu-qty-input" placeholder="QTY" data-price="${adjustedPrice}" data-base-price="${item.price}" data-name="${item.name}" data-item-id="${item.id}">
                        <div>
                            <p class="font-medium">
                                <span class="font-title">${item.name}</span> ↣ $${adjustedPrice}
                            </p>
                            <p class="text-xs md:text-sm mt-1">${item.description || ''}</p>
                            ${addonHTML}
                        </div>
                    </div>
                    ${tagsHTML}
                </div>
            </div>
            <img src="${item.image_url || 'assets/farm.jpg'}" alt="${item.name}" class="menu-item-image w-24 h-24 object-cover rounded-lg border-2 border-accent">
        </div>
    `;
}

// Dashboard functions
async function loadMenuItemsForDashboard() {
    try {
        const { data, error } = await supabase
            .from('menu_items')
            .select('*')
            .order('created_at', { ascending: false });

        if (error) {
            console.error('Error loading dashboard items:', error);
            return;
        }

        displayDashboardItems(data || []);
    } catch (err) {
        console.error('Failed to load dashboard items:', err);
    }
}

function displayDashboardItems(items) {
    const container = document.getElementById('items-list');
    if (!container) return;

    container.innerHTML = items.map(item => {
        const addons = item.addons || [];
        const dietaryTags = item.dietary_tags || [];
        
        return `
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-4">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center gap-4 mb-3">
                            <img src="${item.image_url || 'assets/farm.jpg'}" alt="${item.name}" class="w-16 h-16 object-cover rounded-lg">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">${item.name}</h3>
                                <p class="text-sm text-gray-600">${item.description || ''}</p>
                                <div class="flex items-center gap-4 mt-1">
                                    <span class="text-lg font-bold text-green-600">$${item.price}</span>
                                    <span class="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded">${item.category}</span>
                                    <span class="text-sm ${item.is_available ? 'text-green-600' : 'text-red-600'}">
                                        ${item.is_available ? '● Available' : '● Unavailable'}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        ${dietaryTags.length > 0 ? `
                            <div class="mb-3">
                                <span class="text-sm text-gray-700 font-medium">Dietary Tags: </span>
                                ${dietaryTags.map(tag => `<span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full mr-1">${tag.toUpperCase()}</span>`).join('')}
                            </div>
                        ` : ''}
                        
                        ${addons.length > 0 ? `
                            <div class="mb-3">
                                <span class="text-sm text-gray-700 font-medium">Add-ons: </span>
                                <div class="text-sm text-gray-600">
                                    ${addons.map(addon => `${addon.name} (+$${addon.price})`).join(', ')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="flex gap-2">
                        <button onclick="editItem('${item.id}')" class="bg-black text-white px-4 py-2 rounded-md hover:bg-gray-800 transition-colors text-sm">
                            Edit
                        </button>
                        <button onclick="toggleItemAvailability('${item.id}', ${!item.is_available})" 
                                class="px-4 py-2 rounded-md text-sm transition-colors ${item.is_available ? 'bg-black hover:bg-gray-800 text-white' : 'bg-black hover:bg-gray-800 text-white'}">
                            ${item.is_available ? 'Disable' : 'Enable'}
                        </button>
                        <button onclick="deleteItem('${item.id}')" class="bg-black text-white px-4 py-2 rounded-md hover:bg-gray-800 transition-colors text-sm">
                            Delete
                        </button>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

// Item Modal Functions - Updated to use single popup
function showItemModal(item = null) {
    const authSection = document.getElementById('auth-section');
    const dashboardSection = document.getElementById('dashboard-section');
    const itemFormSection = document.getElementById('item-form-section');
    const modalTitle = document.getElementById('modal-main-title');
    const itemFormTitle = document.getElementById('item-form-title');
    
    // Hide dashboard, show item form
    authSection.classList.add('hidden');
    dashboardSection.classList.add('hidden');
    itemFormSection.classList.remove('hidden');
    
    editingItemId = item ? item.id : null;
    modalTitle.textContent = item ? 'Edit Menu Item' : 'Add New Menu Item';
    itemFormTitle.textContent = item ? 'Edit Item' : 'Add New Item';
    
    // Reset form
    document.getElementById('item-form').reset();
    currentAddons = [];
    updateAddonsDisplay();
    
    if (item) {
        // Populate form with item data
        document.getElementById('item-name').value = item.name || '';
        document.getElementById('item-price').value = item.price || '';
        document.getElementById('item-category').value = item.category || '';
        document.getElementById('item-image-url').value = item.image_url || '';
        document.getElementById('item-description').value = item.description || '';
        document.getElementById('item-available').checked = item.is_available !== false;
        
        // Set dietary tags
        const dietaryTags = item.dietary_tags || [];
        document.getElementById('tag-gf').checked = dietaryTags.includes('gf');
        document.getElementById('tag-v').checked = dietaryTags.includes('v');
        document.getElementById('tag-n').checked = dietaryTags.includes('n');
        
        // Set addons
        currentAddons = item.addons || [];
        updateAddonsDisplay();
    }
}

function hideItemModal() {
    const authSection = document.getElementById('auth-section');
    const dashboardSection = document.getElementById('dashboard-section');
    const itemFormSection = document.getElementById('item-form-section');
    const modalTitle = document.getElementById('modal-main-title');
    
    // Show dashboard, hide item form
    itemFormSection.classList.add('hidden');
    if (currentUser) {
        dashboardSection.classList.remove('hidden');
        modalTitle.textContent = 'Menu Management Dashboard';
    } else {
        authSection.classList.remove('hidden');
        modalTitle.textContent = 'Menu Management Dashboard';
    }
    
    editingItemId = null;
    currentAddons = [];
}

function addAddon() {
    currentAddons.push({ name: '', price: 0 });
    updateAddonsDisplay();
}

function removeAddon(index) {
    currentAddons.splice(index, 1);
    updateAddonsDisplay();
}

function updateAddonsDisplay() {
    const container = document.getElementById('addons-container');
    
    if (currentAddons.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-sm italic">No add-ons added yet</p>';
        return;
    }
    
    container.innerHTML = currentAddons.map((addon, index) => `
        <div class="flex gap-3 items-center bg-gray-50 p-3 rounded-md">
            <input type="text" placeholder="Add-on name" value="${addon.name}" 
                   onchange="currentAddons[${index}].name = this.value"
                   class="flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <input type="number" placeholder="Price" step="0.01" value="${addon.price}" 
                   onchange="currentAddons[${index}].price = parseFloat(this.value) || 0"
                   class="w-24 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <button type="button" onclick="removeAddon(${index})" 
                    class="bg-red-600 text-white px-3 py-2 rounded-md hover:bg-red-700 transition-colors">
                Remove
            </button>
        </div>
    `).join('');
}

// Event listeners setup - Updated
function setupEventListeners() {
    // Account modal
    document.getElementById('account-btn').addEventListener('click', () => {
        document.getElementById('account-modal').classList.remove('hidden');
    });
    
    document.getElementById('mobile-account-btn').addEventListener('click', () => {
        document.getElementById('account-modal').classList.remove('hidden');
    });
    
    document.getElementById('close-modal').addEventListener('click', () => {
        document.getElementById('account-modal').classList.add('hidden');
    });

    // Item form navigation
    document.getElementById('add-item-btn').addEventListener('click', () => showItemModal());
    document.getElementById('back-to-dashboard').addEventListener('click', hideItemModal);
    document.getElementById('cancel-item').addEventListener('click', hideItemModal);
    document.getElementById('add-addon-btn').addEventListener('click', addAddon);
    document.getElementById('item-form').addEventListener('submit', handleSaveItem);

    // Auth forms
    document.getElementById('login-form').addEventListener('submit', handleLogin);
    document.getElementById('logout-btn').addEventListener('click', handleLogout);
}

// Auth handlers
async function handleLogin(e) {
    e.preventDefault();
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;

    try {
        const { error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) throw error;
        alert('Login successful!');
    } catch (error) {
        alert('Login failed: ' + error.message);
    }
}

async function handleLogout() {
    try {
        const { error } = await supabase.auth.signOut();
        if (error) throw error;
        document.getElementById('account-modal').classList.add('hidden');
    } catch (error) {
        alert('Logout failed: ' + error.message);
    }
}

// Menu management handlers
async function handleSaveItem(e) {
    e.preventDefault();
    
    const name = document.getElementById('item-name').value;
    const price = parseFloat(document.getElementById('item-price').value);
    let category = document.getElementById('item-category').value;
    const customCategory = document.getElementById('custom-category').value.trim();
    const imageUrl = document.getElementById('item-image-url').value;
    const description = document.getElementById('item-description').value;
    const isAvailable = document.getElementById('item-available').checked;
    
    // Handle custom category - preserve original formatting
    if (category === 'custom' && customCategory) {
        category = customCategory; // Keep original formatting
        
        // Add to available categories for future use (using original format)
        if (!availableCategories.includes(category)) {
            availableCategories.push(category);
        }
    } else if (category === 'custom' && !customCategory) {
        alert('Please enter a category name or select an existing category');
        return;
    }
    
    // Get dietary tags
    const dietaryTags = [];
    if (document.getElementById('tag-gf').checked) dietaryTags.push('gf');
    if (document.getElementById('tag-v').checked) dietaryTags.push('v');
    if (document.getElementById('tag-n').checked) dietaryTags.push('n');
    
    // Validate addons
    const validAddons = currentAddons.filter(addon => addon.name.trim() !== '');

    if (!name || !price || !category) {
        alert('Please fill in all required fields');
        return;
    }

    try {
        const itemData = {
            name,
            price,
            category,
            description,
            image_url: imageUrl,
            is_available: isAvailable,
            dietary_tags: dietaryTags,
            addons: validAddons
        };
        
        let error;
        if (editingItemId) {
            ({ error } = await supabase
                .from('menu_items')
                .update(itemData)
                .eq('id', editingItemId));
        } else {
            ({ error } = await supabase
                .from('menu_items')
                .insert([itemData]));
        }

        if (error) throw error;
        
        alert(`Item ${editingItemId ? 'updated' : 'added'} successfully!`);
        hideItemModal();
        
        // Reload items and categories
        loadMenuItemsForDashboard();
        loadMenuItems();
        loadAvailableCategories();
    } catch (error) {
        alert(`Failed to ${editingItemId ? 'update' : 'add'} item: ` + error.message);
    }
}

// Edit functionality
function editItem(itemId) {
    const item = menuItems.find(item => item.id === itemId) || 
                 menuItems.find(item => item.id === itemId);
    
    if (!item) {
        // If not found in menuItems, fetch from dashboard data
        supabase.from('menu_items').select('*').eq('id', itemId).single()
            .then(({ data, error }) => {
                if (error) {
                    console.error('Error fetching item:', error);
                    return;
                }
                showItemModal(data);
            });
    } else {
        showItemModal(item);
    }
}

async function toggleItemAvailability(id, isAvailable) {
    try {
        const { error } = await supabase
            .from('menu_items')
            .update({ is_available: isAvailable })
            .eq('id', id);

        if (error) throw error;
        
        loadMenuItemsForDashboard();
        loadMenuItems();
    } catch (error) {
        alert('Failed to update item: ' + error.message);
    }
}

async function deleteItem(id) {
    if (!confirm('Are you sure you want to delete this item?')) return;

    try {
        const { error } = await supabase
            .from('menu_items')
            .delete()
            .eq('id', id);

        if (error) throw error;
        
        loadMenuItemsForDashboard();
        loadMenuItems();
    } catch (error) {
        alert('Failed to delete item: ' + error.message);
    }
}

// Handle category selection
function handleCategoryChange(select) {
    const customInput = document.getElementById('custom-category');
    if (select.value === 'custom') {
        customInput.classList.remove('hidden');
        customInput.focus();
    } else {
        customInput.classList.add('hidden');
        customInput.value = '';
    }
}

// Load unique categories from database
async function loadAvailableCategories() {
    try {
        const { data, error } = await supabase
            .from('menu_items')
            .select('category')
            .not('category', 'is', null);

        if (error) throw error;

        const uniqueCategories = [...new Set(data.map(item => item.category))];
        availableCategories = [...new Set([...availableCategories, ...uniqueCategories])];
        
        updateCategoryDropdown();
    } catch (error) {
        console.error('Error loading categories:', error);
    }
}

// Update category dropdown with available categories
function updateCategoryDropdown() {
    const categorySelect = document.getElementById('item-category');
    if (!categorySelect) return;

    const currentValue = categorySelect.value;
    
    // Clear existing options except the first one and custom option
    categorySelect.innerHTML = `
        <option value="">Select Category</option>
        ${availableCategories.map(cat => {
            const displayName = getCategoryDisplayName(cat);
            return `<option value="${cat}">${displayName}</option>`;
        }).join('')}
        <option value="custom">+ Create New Category</option>
    `;
    
    // Restore selection if it still exists
    if (currentValue && availableCategories.includes(currentValue)) {
        categorySelect.value = currentValue;
    }
}

// Utility functions
function setupPortionSelector() {
    const portionSizes = [5, 10, 20];
    let currentIndex = 1;

    window.adjustPortion = function(change) {
        currentIndex = Math.max(0, Math.min(portionSizes.length - 1, currentIndex + change));
        document.getElementById('portion-size').textContent = portionSizes[currentIndex];
        localStorage.setItem('selectedPortion', portionSizes[currentIndex]);
        
        // Refresh menu display with new prices
        displayMenuItems();
    }

    const savedSize = localStorage.getItem('selectedPortion');
    if (savedSize) {
        const index = portionSizes.indexOf(parseInt(savedSize));
        if (index !== -1) {
            currentIndex = index;
            document.getElementById('portion-size').textContent = savedSize;
        }
    }
}

function setupMobileMenu() {
    const mobileMenuButton = document.querySelector('.mobile-menu-button');
    const mobileMenu = document.querySelector('.mobile-menu');
    
    mobileMenuButton.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
    });
}

function setupCollapsibleSections() {
    document.querySelectorAll('.category-header').forEach(header => {
        header.addEventListener('click', function() {
            const content = this.nextElementSibling;
            const arrow = this.querySelector('.toggle-arrow');
            const isCollapsed = content.style.maxHeight === '0px';
            
            content.style.maxHeight = isCollapsed ? `${content.scrollHeight}px` : '0';
            arrow.style.transform = isCollapsed ? 'rotate(0deg)' : 'rotate(-90deg)';
        });
    });
}

// Function to get portion multiplier
function getPortionMultiplier() {
    const portionSize = parseInt(document.getElementById('portion-size').textContent);
    switch(portionSize) {
        case 5: return 1;
        case 10: return 2;
        case 20: return 4;
        default: return 1;
    }
}

// Update order calculation to use adjusted prices
function setupOrderCalculation() {
    let selectedItems = [];

    document.addEventListener('change', function(e) {
        if (e.target.classList.contains('menu-qty-input') || e.target.classList.contains('addon-select')) {
            updateOrderSummary();
            handleOrderNowButton();
        }
    });

    document.addEventListener('input', function(e) {
        if (e.target.classList.contains('menu-qty-input')) {
            updateOrderSummary();
            handleOrderNowButton();
        }
    });

    function updateOrderSummary() {
        selectedItems = [];
        const multiplier = getPortionMultiplier();
        
        document.querySelectorAll('.menu-qty-input').forEach(input => {
            const quantity = parseInt(input.value) || 0;
            if (quantity > 0) {
                const basePrice = parseFloat(input.dataset.basePrice);
                const adjustedPrice = basePrice * multiplier;
                const name = input.dataset.name;
                const itemId = input.dataset.itemId;
                
                let totalPrice = adjustedPrice;
                let itemName = name;
                
                // Check for addon selection
                const addonSelect = document.querySelector(`select[name="${itemId}_addons"]`);
                if (addonSelect && addonSelect.value) {
                    const selectedOption = addonSelect.options[addonSelect.selectedIndex];
                    const addonPrice = parseFloat(selectedOption.dataset.price) || 0;
                    totalPrice += addonPrice;
                    itemName += ` + ${addonSelect.value}`;
                }
                
                selectedItems.push({
                    name: itemName,
                    quantity,
                    price: totalPrice,
                    total: quantity * totalPrice
                });
            }
        });

        const orderItemsContainer = document.getElementById('order-items-display');
        const subtotalDisplay = document.getElementById('subtotal-display');

        if (selectedItems.length === 0) {
            orderItemsContainer.innerHTML = '<p class="text-center text-secondary/60 text-sm md:text-base">Your selected items will appear here</p>';
            subtotalDisplay.textContent = '$0.00';
            return;
        }

        let subtotal = 0;
        const itemsList = document.createElement('div');
        itemsList.className = 'space-y-2';

        selectedItems.forEach(item => {
            subtotal += item.total;
            const itemElement = document.createElement('div');
            itemElement.className = 'flex justify-between items-center text-sm md:text-base';
            itemElement.innerHTML = `
                <span>${item.quantity} × ${item.name}</span>
                <span class="font-medium">$${item.total.toFixed(2)}</span>
            `;
            itemsList.appendChild(itemElement);
        });

        orderItemsContainer.innerHTML = '';
        orderItemsContainer.appendChild(itemsList);

        const preparationFee = subtotal * 0.18;
        const totalWithTax = subtotal + preparationFee;
        subtotalDisplay.textContent = `$${totalWithTax.toFixed(2)}`;
    }
}

function showWelcomePopup() {
    const welcomePopup = document.createElement('div');
    welcomePopup.className = 'fixed inset-0 flex items-center justify-center bg-black/50 z-50';
    welcomePopup.innerHTML = `
        <div class="bg-primary2 border border-secondary/20 rounded-lg p-6 w-80 md:w-[30rem] max-w-[90vw] mx-4 relative">
            <button class="absolute top-2.5 right-2.5 text-secondary hover:text-accent text-3xl leading-none w-8 h-8 flex items-center justify-center focus:outline-none" id="close-popup">
                &times;
            </button>
            <div class="text-center">
                <div class="flex justify-center mb-4">
                    <img src="assets/logo.png" alt="Your Logo" class="h-16 w-auto invert">
                </div>
                <h4 class="font-medium text-lg mb-4">Welcome to FARM-2-GO</h4>
                <p class="text-sm mb-6">Our FARM-2-GO menu is designed for group orders, with each platter serving 5 people by default. Choose from farm-fresh salads, protein bowls, wraps, and healthy snacks!</p>
                <button id="continue-btn" class="bg-secondary text-white hover:bg-accent px-4 py-2 rounded-md transition-colors">Continue</button>
            </div>
        </div>
    `;
    document.body.appendChild(welcomePopup);
    
    const closeBtn = welcomePopup.querySelector('#close-popup');
    const continueBtn = welcomePopup.querySelector('#continue-btn');

    closeBtn.addEventListener('click', () => welcomePopup.remove());
    continueBtn.addEventListener('click', () => welcomePopup.remove());

    welcomePopup.addEventListener('click', (e) => {
        if (e.target === welcomePopup) welcomePopup.remove();
    });
}

function checkSelectedItems() {
    const quantityInputs = document.querySelectorAll('.menu-qty-input');
    let hasSelectedItems = false;
    
    quantityInputs.forEach(input => {
        if (parseInt(input.value) > 0) {
            hasSelectedItems = true;
        }
    });
    
    return hasSelectedItems;
}

// Function to handle the ORDER NOW button
function handleOrderNowButton() {
    // Remove existing button if it exists
    const existingButton = document.getElementById('order-now-button');
    if (existingButton) {
        existingButton.remove();
    }
    
    // If items are selected, add the button
    if (checkSelectedItems()) {
        const button = document.createElement('button');
        button.id = 'order-now-button';
        button.textContent = 'ORDER NOW';
        button.className = 'fixed bottom-6 right-6 bg-secondary text-primary px-6 py-3 rounded-full hover:bg-accent outline outline-2 outline-primary transition duration-300 tracking-wider shadow-lg z-50';

        button.addEventListener('click', () => {
            const orderForm = document.querySelector('.max-w-4xl.mx-auto.bg-primary');
            if (orderForm) {
                orderForm.scrollIntoView({ behavior: 'smooth' });
            }
        });
        
        document.body.appendChild(button);
    }
}

// Set up event listeners for all quantity inputs (will be called after menu loads)
function setupOrderNowButton() {
    document.querySelectorAll('input[type="number"]').forEach(input => {
        input.addEventListener('change', handleOrderNowButton);
        input.addEventListener('input', handleOrderNowButton);
    });
}

// Initial check in case items are already selected
document.addEventListener('DOMContentLoaded', handleOrderNowButton);
</script>

<script>
// Set current year in copyright
document.getElementById('current-year')?.textContent = new Date().getFullYear();
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Menu items with their prices (this will be dynamic now)
    let selectedItems = [];

    // This will be set up when menu items load
    function setupQuantityInputs() {
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('change', function() {
                if(this.value < 0) this.value = 0;
                updateSelectedItems();
                updateOrderSummary();
            });
        });
    }

    function updateSelectedItems() {
        selectedItems = [];
        document.querySelectorAll('.menu-qty-input').forEach(input => {
            const quantity = parseInt(input.value) || 0;
            if (quantity > 0) {
                const itemName = input.dataset.name;
                const itemPrice = parseFloat(input.dataset.basePrice);
                const itemId = input.dataset.itemId;
                
                let totalPrice = itemPrice;
                let fullName = itemName;
                
                // Check for addon selection
                const addonSelect = document.querySelector(`select[name="${itemId}_addons"]`);
                if (addonSelect && addonSelect.value) {
                    const selectedOption = addonSelect.options[addonSelect.selectedIndex];
                    const addonPrice = parseFloat(selectedOption.dataset.price) || 0;
                    totalPrice += addonPrice;
                    fullName += ` + ${addonSelect.value}`;
                }
                
                selectedItems.push({
                    name: fullName,
                    quantity,
                    price: totalPrice,
                    total: quantity * totalPrice
                });
            }
        });
    }

    function formatCurrency(amount) {
        return '$' + amount.toFixed(2);
    }

    function generateOrderMessage(formData) {
        let message = "=== FARMESILLA CATERING ORDER ===\n\n";

        message += "CLIENT INFORMATION:\n";
        message += `Name: ${formData.get('client_name')}\n`;
        message += `Email: ${formData.get('client_email')}\n`;
        message += `Phone: ${formData.get('client_phone')}\n\n`;

        message += "ORDER DETAILS:\n";
        message += `Order Date: ${formData.get('order_date')}\n`;
        message += `Delivery/Pickup Date: ${formData.get('delivery_date')}\n`;
        message += `Time: ${formData.get('delivery_time')}\n`;

        const deliveryAddress = formData.get('delivery_address');
        if (deliveryAddress) {
            message += `Delivery Address: ${deliveryAddress}\n`;
        } else {
            message += "Pickup: Yes\n";
        }

        message += "\nORDER ITEMS:\n";
        selectedItems.forEach(item => {
            message += `- ${item.quantity} × ${item.name} (${formatCurrency(item.price)} each) = ${formatCurrency(item.total)}\n`;
        });

        const subtotal = selectedItems.reduce((sum, item) => sum + item.total, 0);
        const preparationFee = subtotal * 0.18;
        const total = subtotal + preparationFee;

        message += "\nORDER SUMMARY:\n";
        message += `Subtotal: ${formatCurrency(subtotal)}\n`;
        message += `Preparation Fee (18%): ${formatCurrency(preparationFee)}\n`;
        message += `TOTAL: ${formatCurrency(total)}\n\n`;

        message += "=== END OF ORDER ===";

        return message;
    }

    function updateOrderSummary() {
        const orderItemsContainer = document.getElementById('order-items-display');
        const subtotalDisplay = document.getElementById('subtotal-display');

        orderItemsContainer.innerHTML = '';

        if (selectedItems.length === 0) {
            orderItemsContainer.innerHTML = '<p class="text-center text-secondary/60 text-sm md:text-base">Your selected items will appear here</p>';
            subtotalDisplay.textContent = '$0.00';
            return;
        }

        let subtotal = 0;
        const itemsList = document.createElement('div');
        itemsList.className = 'space-y-2';

        selectedItems.forEach(item => {
            subtotal += item.total;

            const itemElement = document.createElement('div');
            itemElement.className = 'flex justify-between items-center text-sm md:text-base';

            const itemName = document.createElement('span');
            itemName.textContent = `${item.quantity} × ${item.name}`;

            const itemTotal = document.createElement('span');
            itemTotal.textContent = `$${item.total.toFixed(2)}`;
            itemTotal.className = 'font-medium';

            itemElement.appendChild(itemName);
            itemElement.appendChild(itemTotal);
            itemsList.appendChild(itemElement);
        });

        orderItemsContainer.appendChild(itemsList);

        const preparationFee = subtotal * 0.18;
        const totalWithTax = subtotal + preparationFee;

        // Display updated price including 18% tax
        subtotalDisplay.textContent = `$${totalWithTax.toFixed(2)}`;
    }

    document.getElementById('catering-form').addEventListener('submit', function(e) {
        updateSelectedItems();
        const formData = new FormData(this);
        const orderMessage = generateOrderMessage(formData);
        const messageInput = document.createElement('input');
        messageInput.type = 'hidden';
        messageInput.name = 'message';
        messageInput.value = orderMessage;
        this.appendChild(messageInput);
    });

    // Set up initial calculation
    updateOrderSummary();
});
</script>

<script>
// Function to check if any items are selected
function checkSelectedItems() {
    const quantityInputs = document.querySelectorAll('input[type="number"]');
    let hasSelectedItems = false;
    
    quantityInputs.forEach(input => {
        if (parseInt(input.value) > 0) {
            hasSelectedItems = true;
        }
    });
    
    return hasSelectedItems;
}

// Function to handle the ORDER NOW button
function handleOrderNowButton() {
    // Remove existing button if it exists
    const existingButton = document.getElementById('order-now-button');
    if (existingButton) {
        existingButton.remove();
    }
    
    // If items are selected, add the button
    if (checkSelectedItems()) {
        const button = document.createElement('button');
        button.id = 'order-now-button';
        button.textContent = 'ORDER NOW';
        button.className = 'fixed bottom-6 right-6 bg-secondary text-primary px-6 py-3 rounded-full hover:bg-accent outline outline-2 outline-primary transition duration-300 tracking-wider shadow-lg z-50';

        button.addEventListener('click', () => {
            const orderForm = document.querySelector('.max-w-4xl.mx-auto.bg-primary');
            if (orderForm) {
                orderForm.scrollIntoView({ behavior: 'smooth' });
            }
        });
        
        document.body.appendChild(button);
    }
}

// Set up event listeners for all quantity inputs (will be called after menu loads)
function setupOrderNowButton() {
    document.querySelectorAll('input[type="number"]').forEach(input => {
        input.addEventListener('change', handleOrderNowButton);
        input.addEventListener('input', handleOrderNowButton);
    });
}

// Initial check in case items are already selected
document.addEventListener('DOMContentLoaded', handleOrderNowButton);
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const explanations = {
    'gf': 'GLUTEN FREE',
    'v': 'VEGAN',
    'n': 'CONTAINS NUTS'
  };

  // Create popup element
  const popup = document.createElement('div');
  popup.className = 'fixed inset-0 flex items-center justify-center bg-black/50 z-50 hidden';
  popup.innerHTML = `
    <div class="bg-primary2 border border-secondary/20 rounded-lg p-6 w-80 md:w-[30rem] max-w-[90vw] mx-4 relative">
      <!-- Close button -->
      <button class="absolute top-2.5 right-2.5 text-secondary hover:text-accent text-3xl leading-none w-8 h-8 flex items-center justify-center focus:outline-none" id="close-dietary">
        &times;
      </button>

      <!-- Content container -->
      <div class="text-center">
        <!-- Logo with inversion filter -->
        <div class="flex justify-center mb-4">
          <img src="assets/logo.png" alt="Your Logo" class="h-16 w-auto invert">
        </div>

        <!-- Title -->
        <h4 class="font-medium text-lg mb-4">Dietary Information</h4>

        <!-- Content -->
        <p class="text-sm mb-6"></p>

        <!-- Continue button -->
        <button id="continue-dietary" class="bg-secondary text-white hover:bg-accent px-4 py-2 rounded-md transition-colors">Continue</button>
      </div>
    </div>
  `;
  document.body.appendChild(popup);

  // Add click handlers for tags (using event delegation)
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('dietary-tag')) {
      const key = e.target.textContent.toLowerCase().trim();
      const content = explanations[key] || 'No information available';
      
      popup.querySelector('p').textContent = content;
      popup.classList.remove('hidden');
    }
  });

  // Close popup
  const closeBtn = popup.querySelector('#close-dietary');
  const continueBtn = popup.querySelector('#continue-dietary');

  closeBtn.addEventListener('click', () => popup.classList.add('hidden'));
  continueBtn.addEventListener('click', () => popup.classList.add('hidden'));

  popup.addEventListener('click', (e) => {
    if (e.target === popup) popup.classList.add('hidden');
  });
});
</script>

</body>
</html>
